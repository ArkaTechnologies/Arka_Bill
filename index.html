<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Arka Receipt Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f7f9;
    }

    .navbar {
        background-color: #004080;
        color: white;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .navbar-buttons {
        display: flex;
        gap: 10px;
    }

    .navbar button {
        background-color: #ffcc00;
        border: none;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 5px;
        transition: all 0.3s;
    }

    .navbar button:hover {
        background-color: #e6b800;
        transform: translateY(-2px);
    }

    .save-section {
        background-color: #f0f8ff;
        padding: 15px;
        margin: 0 4rem;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .save-section select, .save-section input {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 10px;
    }

    .save-section button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .save-section button:hover {
        background-color: #218838;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background-color: #28a745;
        color: white;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        z-index: 1000;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
    }

    .notification.show {
        opacity: 1;
        transform: translateY(0);
    }

    .notification.error {
        background-color: #dc3545;
    }

    img {
        position: absolute;
        right: 10px;
        margin: 0 4rem;
        width: 150px;
        height: 65px;
    }

    .receipt-meta {
        margin-top: 90px;
        margin-right: 4rem;
    }

    .receipt-meta p {
        display: flex;
        justify-content: right;
        margin-right: 5px;
        margin-top: -10px;
    }

    .receipt-meta .box {
        width: 150px;
        border: 1px solid #ddd;
        padding: 5px;
        border-radius: 4px;
    }

    .container {
        margin: 0 4rem;
        line-height: 10px;
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    header {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
    }

    .int {
        width: 400px;
        margin-left: 4rem;
        padding: 3px;
    }

    #gstInput {
        display: none;
        margin-top: 10px;
    }

    .bill-to {
        margin: 20px 0;
    }

    .bill-to p {
        margin-top: -10px;
    }

    main {
        padding: 5px;
    }

    form {
        margin-bottom: 1.5rem;
        width: 100%;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    form input,
    form button {
        margin: 0 auto;
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    form button {
        background-color: #004080;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    form button:hover {
        background-color: #002b58;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th {
        background-color: green;
        color: #fff;
        border: 1px solid #000;
        padding: 0.75rem;
        text-align: left;
    }

    td {
        border: 1px solid #000;
        padding: 10px;
    }

    .data {
        border-left: hidden;
        border-bottom: hidden;
        text-align: center;
    }

    #itemTableBody td .mid,
    .mid {
        text-align: center;
    }

    .actions button {
        margin-right: 5px;
        padding: 5px 10px;
        font-size: 0.9rem;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .actions button:hover {
        background-color: #e2e6ea;
    }

    .actions button:first-child {
        background-color: #ffc107;
        color: #212529;
    }

    .actions button:last-child {
        background-color: #dc3545;
        color: white;
    }

    #taxRateRow .box {
        width: 25px;
        text-align: end;
    }

    #salesTaxSection {
        display: none;
        margin-top: 10px;
    }

    #taxRate {
        border: none;
        width: 40px;
        text-align: right;
    }

    #taxRate:focus {
        outline: none;
    }

    hr {
        border: .02px solid lightgray;
    }

    .totalInWords {
        margin-top: 2rem;
        line-height: 10px;
        font-size: small;
    }

    footer {
        margin: 50px 4rem;
        position: relative;
        line-height: 6px;
    }

    .signatore {
        position: absolute;
        top: 7px;
        right: 0;
    }

    input:focus {
        outline: none;
        border-color: #004080;
        box-shadow: 0 0 0 2px rgba(0, 64, 128, 0.2);
    }

    .small {
        font-size: small;
        line-height: 5px;
    }

    .footer {
        margin-top: 30px;
    }

    @media print {
        .navbar,
        .save-section,
        nav h1 {
            display: none;
        }

        img {
            margin: 0;
        }

        .receipt-meta {
            margin-top: 90px;
            margin-right: 0;
        }

        .input,
        button,
        .actions,
        h1,
        .btn,
        .show {
            display: none !important;
        }

        .box {
            border: hidden;
        }

        #gstCheckbox {
            display: none;
        }
        
        body {
            background-color: white;
        }
        
        .container {
            box-shadow: none;
            padding: 0;
            margin: 0;
        }

        .container .gst {
            display: none !important;
        }

        footer {
            margin: 50px 0;
        }
    }
</style>

<body>
    <nav class="navbar">
        <h1>Arka Receipt Manager</h1>
        <div class="navbar-buttons">
            <button class="btn" onclick="printPage()">üñ®Ô∏è Print Page</button>
        </div>
    </nav>
    
    <div class="save-section">
        <div>
            <label for="savedInvoices">Load Saved Bill: </label>
            <select id="savedInvoices">
                <option value="">Select a saved invoice</option>
            </select>
            <button onclick="loadSavedBill()">Load</button>
            <button onclick="deleteSavedBill()" style="background-color: #dc3545;">Delete</button>
        </div>
        <div>
            <button onclick="saveBill()" style="background-color: #004080;">üíæ Save Current Bill</button>
        </div>
    </div>
    
    <div id="notification" class="notification">Bill saved successfully!</div>
    
    <hr>
    <div>
        <img src="Arka_logo.png" alt="arka logo">
    </div>
    <div class="receipt-meta">
        <p><strong>Invoice : <input class="box" type="text" id="invoiceNumber"></strong></p>
        <p><strong>Invoice Date : <input class="box" type="date" name="date" id="invoiceDate"></strong></p>
    </div>

    <div class="container">
        <header>
            <div class="logo-section" id="receipt">
                <div>
                    <h2>Arka Technologies</h2>
                    <p>#7C, Sai Ganesha Arcade, Vasavi Street, Old Bangalore Road</p>
                    <p>Hosur, Krishnagiri Dt, India (+91) - 635109</p>
                    <p>Call : (+91) 94884 34411</p>
                </div>
            </div>
        </header>

        <!-- Check box for GST -->
        <label>
            <input type="checkbox" id="gstCheckbox" onchange="toggleGSTInput()"> <span class="gst">Include GST</span>
        </label>

        <div id="gstInput">
            <label for="gstNo">GST NO:</label>
            <input type="text" class="box" id="gstNo" placeholder="Enter GST Number">
        </div>

        <section class="bill-to">
            <p><strong>Bill To:</strong></p>
            <p><input class="int box" type="text" id="billToName" placeholder="Customer Name"></p>
            <p><input class="int box" type="text" id="billToAddress" placeholder="Customer Address"></p>
        </section>

        <main>
            <form id="itemForm">
                <input type="text" id="itemId" class="input" placeholder="ID" required>
                <input type="text" id="description" class="input" placeholder="Description" required>
                <input type="number" id="unit" class="input" placeholder="Unit" required>
                <input type="number" id="amount" class="input" placeholder="Amount" required>
                <button type="submit">Add / Update Item</button>
            </form>

            <table>
                <thead>
                    <tr class="table-head">
                        <th>#</th>
                        <th>DESCRIPTION</th>
                        <th class="mid">UNIT / ITEM</th>
                        <th class="mid">AMOUNT</th>
                        <th class="mid">TOTAL</th>
                        <th class="actions mid">ACTIONS</th>
                    </tr>
                </thead>
                <tbody id="itemTableBody"></tbody>

                <!-- Subtotal & Total -->
                <tr>
                    <td colspan="3" class="data"></td>
                    <td class="data">Subtotal</td>
                    <td>‚Çπ<span id="subtotal">0.00</span></td>
                </tr>

                <tr class="show">
                    <td colspan="3" class="data"></td>
                    <td class="data">
                        <label>
                            <input type="checkbox" id="salesTaxCheckbox" onchange="toggleSalesTax()"> Apply Sales Tax?
                        </label>
                    </td>
                    <td></td>
                </tr>

                <!-- Tax Rate Input + Sales Tax Row -->
                <tr id="taxRateRow" style="display: none;">
                    <td colspan="3" class="data"></td>
                    <td class="data">Tax(%)</td>
                    <td><input type="text" class="box" id="taxRate" value="" oninput="calculateTotals()">%</td>
                </tr>

                <tr id="salesTaxRow" style="display: none;">
                    <td colspan="3" class="data"></td>
                    <td class="data">Tax</td>
                    <td>‚Çπ<span id="tax">0.00</span></td>
                </tr>

                <tr>
                    <td colspan="3" class="data"></td>
                    <td class="data"><strong>Total</strong></td>
                    <td><strong>‚Çπ<span id="total">0.00</span></strong></td>
                </tr>
            </table>
        </main>

        <div class="totalInWords">
            <p><strong>Total in Words :</strong> <span id="totalInWords"> Zero Rupees Only</span></p>
        </div>
    </div>
    <hr>

    <footer>
        <p>Thank you for the Business</p>
        <div class="footer">
            <h3 class="small">Terms & Conditions</h3>
            <div class="signatore">
                <p>Authorised Signatory</p>
            </div>
            <p class="small">1. Product or Service once sold cannot be taken back or exchanged</p>
            <p class="small">2. Full payment is due upon receipt of this invoice</p>
        </div>
    </footer>
    <script>
        let items = [];
        let editIndex = null;

        // Initialize the page
        window.onload = function() {
            loadSavedInvoicesList();
            
            // Set today's date as default
            const today = new Date().toISOString().substr(0, 10);
            document.getElementById('invoiceDate').value = today;
            
            // Generate a simple invoice number if empty
            // const invoiceNumberInput = document.getElementById('invoiceNumber');
            // if (!invoiceNumberInput.value) {
            //     const randomNum = Math.floor(1000 + Math.random() * 9000);
            //     invoiceNumberInput.value = `INV-${today.replace(/-/g, '')}-${randomNum}`;
            // }
        };

        function toggleGSTInput() {
            const checkbox = document.getElementById("gstCheckbox");
            const gstInput = document.getElementById("gstInput");
            gstInput.style.display = checkbox.checked ? "block" : "none";
        }

        document.getElementById("itemForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const id = document.getElementById("itemId").value;
            const desc = document.getElementById("description").value;
            const unit = parseFloat(document.getElementById("unit").value);
            const amount = parseFloat(document.getElementById("amount").value);
            const total = unit * amount;

            const newItem = { id, desc, unit, amount, total };

            if (editIndex === null) {
                items.push(newItem);
            } else {
                items[editIndex] = newItem;
                editIndex = null;
                document.querySelector('#itemForm button').textContent = 'Add Item';
            }

            document.getElementById("itemForm").reset();
            renderTable();
        });

        function renderTable() {
            const tableBody = document.getElementById("itemTableBody");
            tableBody.innerHTML = "";
            items.forEach((item, index) => {
                tableBody.innerHTML += `
          <tr>
            <td>${item.id}</td>
            <td>${item.desc}</td>
            <td class="mid">${item.unit}</td>
            <td class="mid">‚Çπ${item.amount.toFixed(2)}</td>
            <td class="mid">‚Çπ${item.total.toFixed(2)}</td>
            <td class="actions">
              <button onclick="editItem(${index})">Edit</button>
              <button onclick="deleteItem(${index})">Delete</button>
            </td>
          </tr>`;
            });
            calculateTotals();
        }

        function editItem(index) {
            const item = items[index];
            document.getElementById("itemId").value = item.id;
            document.getElementById("description").value = item.desc;
            document.getElementById("unit").value = item.unit;
            document.getElementById("amount").value = item.amount;
            editIndex = index;
            document.querySelector('#itemForm button').textContent = 'Update Item';
        }

        function deleteItem(index) {
            if (confirm("Are you sure you want to delete this item?")) {
                items.splice(index, 1);
                renderTable();
            }
        }

        function printPage() {
            window.print();
        }

        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function saveBill() {
            const invoiceNumber = document.getElementById("invoiceNumber").value;
            if (!invoiceNumber) {
                showNotification("Please enter an invoice number before saving.", true);
                return;
            }

            const billData = {
                invoiceNumber: invoiceNumber,
                invoiceDate: document.getElementById("invoiceDate").value,
                gstEnabled: document.getElementById("gstCheckbox").checked,
                gstNo: document.getElementById("gstNo").value,
                billToName: document.getElementById("billToName").value,
                billToAddress: document.getElementById("billToAddress").value,
                items: items,
                taxRate: document.getElementById("taxRate").value,
                applyTax: document.getElementById("salesTaxCheckbox").checked,
                subtotal: document.getElementById("subtotal").textContent,
                tax: document.getElementById("tax").textContent,
                total: document.getElementById("total").textContent,
                totalInWords: document.getElementById("totalInWords").textContent
            };

            // Save to localStorage using invoice number as key
            localStorage.setItem(`arka_invoice_${invoiceNumber}`, JSON.stringify(billData));
            
            // Update the saved invoices list
            loadSavedInvoicesList();
            
            showNotification(`Bill saved successfully with invoice number: ${invoiceNumber}`);
        }

        function loadSavedInvoicesList() {
            const select = document.getElementById("savedInvoices");
            const currentValue = select.value;
            select.innerHTML = '<option value="">Select a saved invoice</option>';
            
            // Get all keys from localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith("arka_invoice_")) {
                    const invoiceNumber = key.replace("arka_invoice_", "");
                    const option = document.createElement("option");
                    option.value = invoiceNumber;
                    option.textContent = invoiceNumber;
                    select.appendChild(option);
                }
            }
            
            // Restore previous selection if still available
            if (currentValue) {
                const optionExists = Array.from(select.options).some(option => option.value === currentValue);
                if (optionExists) {
                    select.value = currentValue;
                }
            }
        }

        function loadSavedBill() {
            const invoiceNumber = document.getElementById("savedInvoices").value;
            if (!invoiceNumber) {
                showNotification("Please select an invoice to load.", true);
                return;
            }
            
            const savedData = localStorage.getItem(`arka_invoice_${invoiceNumber}`);
            if (savedData) {
                try {
                    const billData = JSON.parse(savedData);
                    
                    // Populate the form with saved data
                    document.getElementById("invoiceNumber").value = billData.invoiceNumber;
                    document.getElementById("invoiceDate").value = billData.invoiceDate;
                    document.getElementById("gstCheckbox").checked = billData.gstEnabled;
                    document.getElementById("gstNo").value = billData.gstNo || "";
                    document.getElementById("billToName").value = billData.billToName || "";
                    document.getElementById("billToAddress").value = billData.billToAddress || "";
                    
                    // Show GST input if enabled
                    toggleGSTInput();
                    
                    // Load items
                    items = billData.items || [];
                    renderTable();
                    
                    // Load tax settings
                    document.getElementById("salesTaxCheckbox").checked = billData.applyTax;
                    document.getElementById("taxRate").value = billData.taxRate || "";
                    toggleSalesTax();
                    
                    // Update totals
                    document.getElementById("subtotal").textContent = billData.subtotal;
                    document.getElementById("tax").textContent = billData.tax;
                    document.getElementById("total").textContent = billData.total;
                    document.getElementById("totalInWords").textContent = billData.totalInWords;
                    
                    showNotification(`Invoice loaded: ${invoiceNumber}`);
                } catch (e) {
                    showNotification("Error loading saved bill. Data might be corrupted.", true);
                    console.error("Error parsing saved bill:", e);
                }
            } else {
                showNotification("No saved bill found with that invoice number.", true);
            }
        }

        function deleteSavedBill() {
            const invoiceNumber = document.getElementById("savedInvoices").value;
            if (!invoiceNumber) {
                showNotification("Please select an invoice to delete.", true);
                return;
            }
            
            if (confirm(`Are you sure you want to delete the saved bill "${invoiceNumber}"?`)) {
                localStorage.removeItem(`arka_invoice_${invoiceNumber}`);
                loadSavedInvoicesList();
                showNotification(`Bill deleted: ${invoiceNumber}`);
            }
        }

        function toggleSalesTax() {
            const checkbox = document.getElementById("salesTaxCheckbox");
            const show = checkbox.checked;

            document.getElementById("taxRateRow").style.display = show ? "table-row" : "none";
            document.getElementById("salesTaxRow").style.display = show ? "table-row" : "none";

            calculateTotals();
        }

        function convertNumberToWords(amount) {
            const words = {
                0: '', 1: 'One', 2: 'Two', 3: 'Three', 4: 'Four',
                5: 'Five', 6: 'Six', 7: 'Seven', 8: 'Eight', 9: 'Nine',
                10: 'Ten', 11: 'Eleven', 12: 'Twelve', 13: 'Thirteen',
                14: 'Fourteen', 15: 'Fifteen', 16: 'Sixteen', 17: 'Seventeen',
                18: 'Eighteen', 19: 'Nineteen', 20: 'Twenty', 30: 'Thirty',
                40: 'Forty', 50: 'Fifty', 60: 'Sixty', 70: 'Seventy',
                80: 'Eighty', 90: 'Ninety'
            };

            function numberToWords(n) {
                if (n === 0) return 'Zero';
                if (n < 20) return words[n];
                if (n < 100) return words[Math.floor(n / 10) * 10] + (n % 10 ? ' ' + words[n % 10] : '');
                if (n < 1000) return numberToWords(Math.floor(n / 100)) + ' Hundred' + (n % 100 ? ' ' + numberToWords(n % 100) : '');
                if (n < 100000) return numberToWords(Math.floor(n / 1000)) + ' Thousand' + (n % 1000 ? ' ' + numberToWords(n % 1000) : '');
                if (n < 10000000) return numberToWords(Math.floor(n / 100000)) + ' Lakh' + (n % 100000 ? ' ' + numberToWords(n % 100000) : '');
                return numberToWords(Math.floor(n / 10000000)) + ' Crore' + (n % 10000000 ? ' ' + numberToWords(n % 10000000) : '');
            }

            const roundedAmount = Math.round(amount);
            return numberToWords(roundedAmount) + ' Rupees Only';
        }
        
        function calculateTotals() {
            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const applyTax = document.getElementById("salesTaxCheckbox").checked;
            const taxRate = parseFloat(document.getElementById("taxRate").value) || 0;

            let taxAmount = 0;
            if (applyTax) {
                taxAmount = (subtotal * taxRate) / 100;
            }

            const total = subtotal + taxAmount;

            document.getElementById("subtotal").textContent = subtotal.toFixed(2);
            document.getElementById("tax").textContent = taxAmount.toFixed(2);
            document.getElementById("total").textContent = total.toFixed(2);

            // Convert total to words (rounded)
            document.getElementById("totalInWords").textContent = convertNumberToWords(total);
        }
    </script>
</body>
</html>